<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="icon" type="image/ico" sizes="32x32" href="//cdn.jsdelivr.net/gh/amehime/shoka@latest/images/favicon.ico"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Noto Serif JP:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/themes/pink/pace-theme-minimal.css,npm/katex@0/dist/contrib/copy-tex.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0/dist/katex.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/amehime/shoka@latest/css/app.css"><meta name="keywords" content="笔记,机场,"><link rel="canonical" href="https://shoka.lostyu.me/computer-science/note/v2yume-setup-log/"><meta name="description" content="以下内容基于：V2board：多用户管理，aaPanel + LNMP + Laravel + ReactPoseidon ：V2Ray 服务端，基于 docker 运行CloudFlare：实现 WebSocket-TLS 模式# 服务器准备SSH 连接 Linux 服务器，操作系统 CentOS 7最低配置要求为 1Core&#x2F;512M RAM# 安装内核加速推荐使用 bbr plus 。先安装"><meta property="og:type" content="article"><meta property="og:title" content="V2Yume 配置记录"><meta property="og:url" content="https://shoka.lostyu.me/computer-science/note/v2yume-setup-log/"><meta property="og:site_name" content="優萌初華"><meta property="og:description" content="以下内容基于：V2board：多用户管理，aaPanel + LNMP + Laravel + ReactPoseidon ：V2Ray 服务端，基于 docker 运行CloudFlare：实现 WebSocket-TLS 模式# 服务器准备SSH 连接 Linux 服务器，操作系统 CentOS 7最低配置要求为 1Core&#x2F;512M RAM# 安装内核加速推荐使用 bbr plus 。先安装"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2020-06-16T13:11:48.000Z"><meta property="article:modified_time" content="2020-06-26T16:54:09.544Z"><meta property="article:author" content="Ruri Shimotsuki"><meta property="article:tag" content="笔记"><meta property="article:tag" content="机场"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@amehime"><title>V2Yume 配置记录 - 二进制杂谈 - 计算机科学 | Yume Shoka = 優萌初華 = 有夢書架</title><meta name="generator" content="Hexo 4.2.1"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="loading"><div class="cat"><div class="body"></div><div class="body"></div><div class="tail"></div><div class="head"></div></div></div><div class="container"><header itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><nav><div class="inner"><div class="toggle menu"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="list menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-archive"></i>归档</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>网址</a></li></ul><div class="right menu"><div class="search-btn"><i class="ic i-search ic-lg"></i></div><div class="back-to-top"><i class="ic i-arrow-up"></i> <span>0%</span></div></div></div></nav><div class="brand"><div class="meta"><a href="/" class="logo" rel="start"><span class="artboard"></span><h1 class="title">優萌初華</h1></a><p class="subtitle" itemprop="description">= 有夢書架 =</p></div><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><div class="search"><div class="inner"><div class="header"><span class="icon"><i class="ic i-search"></i></span><div class="search-input-container"></div><span class="close-btn"><i class="ic i-times-circle"></i></span></div><div class="results"><div class="inner"><div id="search-stats"></div><div id="search-hits"></div><div id="search-pagination"></div></div></div></div></div></div><ul class="lozad"><li data-background-image="//cdn.jsdelivr.net/gh/amehime/shoka@latest/images/banner/1.jpg"></li><li data-background-image="//cdn.jsdelivr.net/gh/amehime/shoka@latest/images/banner/2.jpg"></li><li data-background-image="//cdn.jsdelivr.net/gh/amehime/shoka@latest/images/banner/3.jpg"></li><li data-background-image="//cdn.jsdelivr.net/gh/amehime/shoka@latest/images/banner/4.jpg"></li><li data-background-image="//cdn.jsdelivr.net/gh/amehime/shoka@latest/images/banner/5.jpg"></li><li data-background-image="//cdn.jsdelivr.net/gh/amehime/shoka@latest/images/banner/6.jpg"></li></ul></header><main><div class="inner"><div class="content pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-th"></i> <span><a href="/">首页</a> </span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/computer-science/" itemprop="item" rel="index" title="分类于 计算机科学"><span itemprop="name">计算机科学</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/computer-science/note/" itemprop="item" rel="index" title="分类于 二进制杂谈"><span itemprop="name">二进制杂谈</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://shoka.lostyu.me/computer-science/note/v2yume-setup-log/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Ruri Shimotsuki"><meta itemprop="description" content="有夢書架琉璃的医学 & 编程笔记"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="優萌初華"></span><header><h1 class="title" itemprop="name headline">V2Yume 配置记录</h1><div class="meta"><span class="item" title="创建时间：2020-06-16 21:11:48"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2020-06-16T21:11:48+08:00">2020-06-16</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-file-word"></i> </span><span class="text">本文字数</span> <span>5.2k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>&asymp; 5 分钟</span></span></div><div class="tags"><a href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag"><i class="ic i-tag"></i> 笔记</a> <a href="/tags/%E6%9C%BA%E5%9C%BA/" rel="tag"><i class="ic i-tag"></i> 机场</a></div></header><div class="body" itemprop="articleBody"><div class="note info"><p>以下内容基于：</p><ul><li><a href="https://github.com/v2board/v2board" target="_blank" rel="noopener">V2board</a>：多用户管理，aaPanel + LNMP + Laravel + React</li><li><a href="https://github.com/ColetteContreras/v2ray-poseidon" target="_blank" rel="noopener">Poseidon</a> ：V2Ray 服务端，基于 docker 运行</li><li><a href="https://www.cloudflare.com/" target="_blank" rel="noopener">CloudFlare</a>：实现 WebSocket-TLS 模式</li></ul></div><h1 id="服务器准备"><a class="anchor" href="#服务器准备">#</a> 服务器准备</h1><p>SSH 连接 Linux 服务器，操作系统 <code>CentOS 7</code><br>最低配置要求为 1Core/512M RAM</p><h2 id="安装内核加速"><a class="anchor" href="#安装内核加速">#</a> 安装内核加速</h2><p>推荐使用 <code>bbr plus</code> 。<br>先安装内核，选择 2，重启后，开启加速，选择 7。</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br>2<br>3<br></pre><pre class="code"><span class="token function">wget</span> -N --no-check-certificate <span class="token string">"https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/tcp.sh"</span><br><span class="token function">chmod</span> +x tcp.sh<br>./tcp.sh<br></pre></div></figure><h2 id="同步服务器时间"><a class="anchor" href="#同步服务器时间">#</a> 同步服务器时间</h2><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br>2<br>3<br></pre><pre class="code">yum -y <span class="token function">install</span> ntpdate<br>timedatectl set-timezone Asia/Shanghai <span class="token comment">#设置为北京时间</span><br>ntpdate time.nist.gov<br></pre></div></figure><blockquote><p>ntp 常用服务器</p></blockquote><table><thead><tr><th>Name</th><th>IP</th><th>Location</th></tr></thead><tbody><tr><td>210.72.145.44</td><td>210.72.145.44</td><td>中国（国家授时中心）</td></tr><tr><td><a href="http://ntp.fudan.edu.cn" target="_blank" rel="noopener">ntp.fudan.edu.cn</a></td><td></td><td>中国（复旦大学）</td></tr><tr><td><a href="http://ntp.api.bz" target="_blank" rel="noopener">ntp.api.bz</a></td><td></td><td>中国（上海 NTP 服务器）</td></tr><tr><td>133.100.11.8</td><td>133.100.11.8</td><td>日本（福冈大学）</td></tr><tr><td><a href="http://asia.pool.ntp.org" target="_blank" rel="noopener">asia.pool.ntp.org</a></td><td></td><td>台湾（台警大授时中心）</td></tr><tr><td><a href="http://time.windows.com" target="_blank" rel="noopener">time.windows.com</a></td><td></td><td>美国（微软公司授时主机）</td></tr><tr><td><a href="http://time-a.nist.gov" target="_blank" rel="noopener">time-a.nist.gov</a></td><td>129.6.15.28</td><td>NIST,Gaithersburg,Maryland</td></tr><tr><td><a href="http://time-b.nist.gov" target="_blank" rel="noopener">time-b.nist.gov</a></td><td>129.6.15.29</td><td>NIST,Gaithersburg,Maryland</td></tr><tr><td><a href="http://time-a.timefreq.bldrdoc.gov" target="_blank" rel="noopener">time-a.timefreq.bldrdoc.gov</a></td><td>132.163.4.101</td><td>NIST,Boulder,Colorado</td></tr><tr><td><a href="http://time-b.timefreq.bldrdoc.gov" target="_blank" rel="noopener">time-b.timefreq.bldrdoc.gov</a></td><td>132.163.4.102</td><td>NIST,Boulder,Colorado</td></tr><tr><td><a href="http://time-c.timefreq.bldrdoc.gov" target="_blank" rel="noopener">time-c.timefreq.bldrdoc.gov</a></td><td>132.163.4.103</td><td>NIST,Boulder,Colorado</td></tr><tr><td><a href="http://utcnist.colorado.edu" target="_blank" rel="noopener">utcnist.colorado.edu</a></td><td>128.138.140.44</td><td>UniversityofColorado,Boulder</td></tr><tr><td><a href="http://time.nist.gov" target="_blank" rel="noopener">time.nist.gov</a></td><td>192.43.244.18</td><td>NCAR,Boulder,Colorado</td></tr><tr><td><a href="http://time-nw.nist.gov" target="_blank" rel="noopener">time-nw.nist.gov</a></td><td>131.107.1.10</td><td>Microsoft,Redmond,Washington</td></tr><tr><td><a href="http://nist1.symmetricom.com" target="_blank" rel="noopener">nist1.symmetricom.com</a></td><td>69.25.96.13</td><td>Symmetricom,SanJose,California</td></tr><tr><td><a href="http://nist1-dc.glassey.com" target="_blank" rel="noopener">nist1-dc.glassey.com</a></td><td>216.200.93.8</td><td>Abovenet,Virginia</td></tr><tr><td><a href="http://nist1-ny.glassey.com" target="_blank" rel="noopener">nist1-ny.glassey.com</a></td><td>208.184.49.9</td><td>Abovenet,NewYorkCity</td></tr><tr><td><a href="http://nist1-sj.glassey.com" target="_blank" rel="noopener">nist1-sj.glassey.com</a></td><td>207.126.98.204</td><td>Abovenet,SanJose,California</td></tr><tr><td><a href="http://nist1.aol-ca.truetime.com" target="_blank" rel="noopener">nist1.aol-ca.truetime.com</a></td><td>207.200.81.113</td><td>TrueTime,AOLfacility,Sunnyvale,California</td></tr><tr><td><a href="http://nist1.aol-va.truetime.com" target="_blank" rel="noopener">nist1.aol-va.truetime.com</a></td><td>64.236.96.53</td><td>TrueTime,AOLfacility,Virginia</td></tr></tbody></table><h2 id="关闭防火墙"><a class="anchor" href="#关闭防火墙">#</a> 关闭防火墙</h2><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br>2<br>3<br></pre><pre class="code">systemctl start supervisord<br>systemctl disable firewalld<br>systemctl stop firewalld<br></pre></div></figure><h1 id="域名准备"><a class="anchor" href="#域名准备">#</a> 域名准备</h1><p>借助 <a href="https://www.cloudflare.com/" target="_blank" rel="noopener">CloudFlare</a> 实现强制 SSL、CDN 加速、隐藏 IP 地址 blabla</p><p>需要注意的配置：</p><ul><li>DNS 解析，代理状态为 已代理。</li><li>您的 SSL/TLS 加密模式为 完全 FULL！</li></ul><h1 id="v2board安装"><a class="anchor" href="#v2board安装">#</a> V2Board 安装</h1><h2 id="基于aapanel部署"><a class="anchor" href="#基于aapanel部署">#</a> 基于<a href="https://forum.aapanel.com/d/9-aapanel-linux-panel-670-installation-tutorial" target="_blank" rel="noopener"> aaPanel</a> 部署</h2><ol><li><p>安装 aaPanel</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br></pre><pre class="code">yum <span class="token function">install</span> -y <span class="token function">wget</span> <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O install.sh http://www.aapanel.com/script/install_6.0_en.sh <span class="token operator">&amp;&amp;</span> <span class="token function">bash</span> install.sh<br></pre></div></figure><p>安装完成后登陆，进行环境的安装。</p><p>选择使用 LNMP 的环境安装方式勾选如下信息：</p><p>☑️ Nginx 1.17<br>☑️ MySQL 5.6<br>☑️ PHP 7.3</p><p>选择 Fast 快速编译后进行安装。</p></li><li><p>安装 Redis<br>aaPanel 面板 &gt; App Store &gt; 找到 PHP 7.3 点击 Setting &gt; Install extentions &gt; redis 进行安装。</p></li><li><p>解除被禁止的函数<br>aaPanel 面板 &gt; App Store &gt; 找到 PHP 7.3 点击 Setting &gt; Disabled functions 将 <code>putenv</code> <code>proc_open</code> <code>pcntl_alarm</code> <code>pcntl_signal</code> 从列表中删除。</p></li><li><p>添加站点<br>aaPanel 面板 &gt; Website &gt; Add site。</p><blockquote><p>在 Domain 填入你指向服务器的域名<br>在 Database 选择 MySQL<br>在 PHP Verison 选择 PHP-73</p></blockquote></li><li><p>安装 V2Board<br>通过 SSH 登录到服务器后访问站点路径如： <code>/www/wwwroot/domain.com</code> 。</p><p>以下命令都需要在站点目录进行执行。</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br>2<br>3<br></pre><pre class="code"><span class="token comment"># 删除目录下文件</span><br>chattr -i .user.ini<br><span class="token function">rm</span> -rf .htaccess <span class="token number">404</span>.html index.html .user.ini<br></pre></div></figure><p>执行命令从 Github 克隆到当前目录。</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br></pre><pre class="code"><span class="token function">git</span> clone https://github.com/v2board/v2board.git ./<br></pre></div></figure><p>执行命令下载 composer.phar 到当前目录。</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br></pre><pre class="code"><span class="token function">wget</span> https://getcomposer.org/download/1.9.0/composer.phar<br></pre></div></figure><p>执行命令进行包安装。</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br></pre><pre class="code">php composer.phar <span class="token function">install</span><br></pre></div></figure><p>安装过程中报错或者无法继续安装的请分配 swap，如何分配 swap 请查阅 google。</p><p>执行命令安装 V2board</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br></pre><pre class="code">php artisan v2board:install<br></pre></div></figure><p>根据提示完成安装。</p></li><li><p>配置站点目录及伪静态<br>添加完成后编辑添加的站点 &gt; Site directory &gt; Running directory 选择 /public 保存。</p><p>添加完成后编辑添加的站点 &gt; URL rewrite 填入伪静态信息。</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br></pre><pre class="code">location /downloads <span class="token punctuation">{</span><br><span class="token punctuation">}</span><br><br>location / <span class="token punctuation">{</span>  <br>    try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.php<span class="token variable">$is_args</span><span class="token variable">$query_string</span><span class="token punctuation">;</span>  <br><span class="token punctuation">}</span><br><br>location ~ .*<span class="token punctuation">\</span>.<span class="token punctuation">(</span>js<span class="token operator">|</span>css<span class="token punctuation">)</span>?$<br><span class="token punctuation">{</span><br>    expires      1h<span class="token punctuation">;</span><br>    error_log off<span class="token punctuation">;</span><br>    access_log /dev/null<span class="token punctuation">;</span> <br><span class="token punctuation">}</span><br></pre></div></figure></li><li><p>配置定时任务<br>aaPanel 面板 &gt; Cron。</p><blockquote><p>在 Type of Task 选择 Shell Script<br>在 Name of Task 填写 v2board<br>在 Period 选择 N Minutes 1 Minute<br>在 Script content 填写 php /www/wwwroot/domain.com/artisan schedule:run</p></blockquote><p>根据上述信息添加每 1 分钟执行一次的定时任务。<br>记得将路径修改成自己的。</p></li><li><p>启动队列服务<br>V2board 的邮件系统强依赖队列服务，你想要使用邮件验证及群发邮件必须启动队列服务。<br>下面以 aaPanel 中 nodejs 的 PM2 服务来守护队列服务作为演示。</p><p>aaPanel 面板 &gt; App Store &gt; Deployment</p><p>找到 PM2 Manager 4.2.2 进行安装，安装完成后按照如下填写</p><blockquote><p>在 Project root directory 选择站点目录<br>在 Startup file name 填写 pm2.yaml<br>在 project name 填写 v2board</p></blockquote><p>填写后点击 Add 添加即可运行。当然你也可以使用 supervisor 进行守护。</p></li></ol><h2 id="告别500错误"><a class="anchor" href="#告别500错误">#</a> 告别 500 错误</h2><ol><li><p>目录权限问题，检查站点根目录权限，递归 755，保证目录有可写文件的权限</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br></pre><pre class="code"><span class="token function">chown</span> -R www:www *<br></pre></div></figure></li><li><p>修改 <code>.env</code> 文件， <code>APP_DEBUG=true</code> ，开启 debug 模式，查看具体报错内容<br>每次修改 .env 文件后需要执行以下命令清空缓存</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br></pre><pre class="code">php artisan config:clear<br></pre></div></figure></li><li><p>aaPanel 安装 Redis 扩展失败<br>如报错</p><blockquote><p>configure: error: C preprocessor “/lib/cpp” fails sanity check</p></blockquote><p>缺少必要的 C++ 库，如下命令重装解决。</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br></pre><pre class="code">yum reinstall glibc-headers gcc-c++ -y<br></pre></div></figure></li></ol><h2 id="节点配置"><a class="anchor" href="#节点配置">#</a> 节点配置</h2><ol><li><p>在 系统配置 &gt; 服务端 界面，设置一个 <code>通讯密钥</code></p></li><li><p>先添加权限组，再添加节点，记录 <code>节点ID</code> ，协议配置中的 <code>路径</code></p><blockquote><p>节点地址： 你的代理服务器绑定的域名<br>TLS： 支持<br>连接端口： 443<br>服务端口： 443<br>传输协议： WebSocket<br>点击编辑传输协议配置</p></blockquote><figure class="highlight json"><figcaption><span class="lang">JSON</span></figcaption><div class="code-container"><pre class="gutter">1<br>2<br>3<br></pre><pre class="code"><span class="token punctuation">{</span><br>    <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"/路径"</span><br><span class="token punctuation">}</span><br></pre></div></figure></li></ol><h1 id="poseidon对接"><a class="anchor" href="#poseidon对接">#</a> Poseidon 对接</h1><h2 id="安装并启动-dockerdocker-compose"><a class="anchor" href="#安装并启动-dockerdocker-compose">#</a> 安装并启动 Docker/docker-compose</h2><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br></pre><pre class="code"><span class="token function">curl</span> -fsSL https://get.docker.com <span class="token operator">|</span> <span class="token function">bash</span><br><span class="token function">curl</span> -L <span class="token string">"https://github.com/docker/compose/releases/download/1.25.3/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span>"</span> -o /usr/local/bin/docker-compose<br><span class="token function">chmod</span> a+x /usr/local/bin/docker-compose<br><span class="token function">rm</span> -f <span class="token variable"><span class="token variable">`</span><span class="token function">which</span> <span class="token function">dc</span><span class="token variable">`</span></span> <br><span class="token function">ln</span> -s /usr/local/bin/docker-compose /usr/bin/dc<br> <br>systemctl start docker<br><span class="token function">service</span> docker start<br>systemctl <span class="token builtin class-name">enable</span> docker.service<br>systemctl status docker.service<br></pre></div></figure><h2 id="安装v2ray-poseidon"><a class="anchor" href="#安装v2ray-poseidon">#</a> 安装 v2ray-poseidon</h2><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br>2<br></pre><pre class="code"><span class="token function">curl</span> -o go.sh -L -s https://raw.githubusercontent.com/ColetteContreras/v2ray-poseidon/master/install-release.sh<br><span class="token function">sudo</span> <span class="token function">bash</span> go.sh <span class="token comment"># Install latest version of v2ray-poseidon</span><br></pre></div></figure><h2 id="修改配置文件"><a class="anchor" href="#修改配置文件">#</a> 修改配置文件</h2><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br></pre><pre class="code"><span class="token builtin class-name">cd</span> /root/v2ray-poseidon/docker/v2board/ws<br></pre></div></figure><p>修改 config.json</p><figure class="highlight json"><figcaption><span class="lang">JSON</span></figcaption><div class="code-container"><pre class="gutter">1<br>2<br>3<br></pre><pre class="code"><span class="token property">"nodeId"</span><span class="token operator">:</span> <span class="token comment">// 面板里添加完节点后生成的自增 ID</span><br><span class="token property">"webapi"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><span class="token comment">//v2board 的域名信息</span><br><span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//v2board 和 v2ray-poseidon 的通信密钥</span><br></pre></div></figure><p>修改 docker-compose.yml</p><figure class="highlight yaml"><figcaption><span class="lang">YAML</span></figcaption><div class="code-container"><pre class="gutter">1<br>2<br></pre><pre class="code"><span class="token key atrule">ports</span><span class="token punctuation">:</span><br>  <span class="token punctuation">-</span> <span class="token string">"80:10086"</span> <span class="token comment"># 把 80 端口 修改掉，避免端口占用报错</span><br></pre></div></figure><h2 id="添加站点"><a class="anchor" href="#添加站点">#</a> 添加站点</h2><p>aaPanel 添加一个站点，域名就是代理服务器想绑定的域名。</p><p>站点配置 Configuration &gt; SSL &gt; Let's Encrypt &gt; 选择 Cloudflare &gt; 配置一下邮箱和 API</p><p>站点配置 Configuration &gt; Config</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br></pre><pre class="code">location /路径 <span class="token comment"># 节点 websocket 配置中的路径</span><br><span class="token punctuation">{</span><br>    proxy_pass http://127.0.0.1:端口号<span class="token punctuation">;</span> <span class="token comment"># docker-compose.yml 里改掉的 端口号</span><br>    proxy_redirect off<span class="token punctuation">;</span><br>    proxy_http_version <span class="token number">1.1</span><span class="token punctuation">;</span><br>    proxy_set_header Upgrade <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span><br>    proxy_set_header Connection <span class="token string">"upgrade"</span><span class="token punctuation">;</span><br>    proxy_set_header Host <span class="token variable">$http_host</span><span class="token punctuation">;</span><br>    proxy_read_timeout 300s<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br></pre></div></figure><p>Security &gt; Firewall &gt; 放行上述端口号</p><h2 id="启动docker"><a class="anchor" href="#启动docker">#</a> 启动 Docker</h2><p>保持后台运行。</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br></pre><pre class="code"><span class="token function">dc</span> up -d<br></pre></div></figure><p>查看一下日志，看看有没有报错。</p><figure class="highlight bash"><figcaption><span class="lang">bash</span></figcaption><div class="code-container"><pre class="gutter">1<br></pre><pre class="code"><span class="token function">dc</span> logs<br></pre></div></figure><h1 id="配置相关"><a class="anchor" href="#配置相关">#</a> 配置相关</h1><h2 id="支付配置"><a class="anchor" href="#支付配置">#</a> 支付配置</h2><p>目前支持四种方式，但是都不太理想</p><ul><li>支付宝，容易被请喝茶</li><li>Stripe，很难申请</li><li>BitpayX，对用户不友好</li><li>PayTaro，好不容易才找到了注册接口，收费 50 软妹币，暂时选用这个</li></ul><p>事实上，只是打算自用，并不打算卖钱，毕竟只有一个节点，呵呵_(:зゝ∠)_</p></div><footer><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="//cdn.jsdelivr.net/gh/amehime/shoka@latest/images/wechatpay.png" alt="Ruri Shimotsuki 微信支付"><p>微信支付</p></div><div><img data-src="//cdn.jsdelivr.net/gh/amehime/shoka@latest/images/alipay.png" alt="Ruri Shimotsuki 支付宝"><p>支付宝</p></div><div><img data-src="//cdn.jsdelivr.net/gh/amehime/shoka@latest/images/paypal.png" alt="Ruri Shimotsuki 贝宝"><p>贝宝</p></div></div></div><div class="copyright"><ul><li class="author"><strong>本文作者： </strong>Ruri Shimotsuki</li><li class="link"><strong>本文链接：</strong> <a href="https://shoka.lostyu.me/computer-science/note/v2yume-setup-log/" title="V2Yume 配置记录">https://shoka.lostyu.me/computer-science/note/v2yume-setup-log/</a></li><li class="license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh" rel="noopener" target="_blank"><i class="ic i-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="nav"><div class="inner"><div class="item"><a href="/computer-science/cpp/course-1/week-6/" rel="prev"><i class="ic i-chevron-left"></i> 上一篇</a></div><div class="item"><a href="/interdisciplinary/health-informatics/specialization-1/course-1/week-1/" rel="next">下一篇 <i class="ic i-chevron-right"></i></a></div></div></div><div class="comments wrap" id="comments" data-id="3fa47f28a1add1b47840367ce00c8fd0"></div></div><div class="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#服务器准备"><span class="toc-number">1.</span> <span class="toc-text">服务器准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装内核加速"><span class="toc-number">1.1.</span> <span class="toc-text">安装内核加速</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#同步服务器时间"><span class="toc-number">1.2.</span> <span class="toc-text">同步服务器时间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关闭防火墙"><span class="toc-number">1.3.</span> <span class="toc-text">关闭防火墙</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#域名准备"><span class="toc-number">2.</span> <span class="toc-text">域名准备</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#v2board安装"><span class="toc-number">3.</span> <span class="toc-text">V2Board 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基于aapanel部署"><span class="toc-number">3.1.</span> <span class="toc-text">基于 aaPanel 部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#告别500错误"><span class="toc-number">3.2.</span> <span class="toc-text">告别 500 错误</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#节点配置"><span class="toc-number">3.3.</span> <span class="toc-text">节点配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#poseidon对接"><span class="toc-number">4.</span> <span class="toc-text">Poseidon 对接</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装并启动-dockerdocker-compose"><span class="toc-number">4.1.</span> <span class="toc-text">安装并启动 Docker&#x2F;docker-compose</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装v2ray-poseidon"><span class="toc-number">4.2.</span> <span class="toc-text">安装 v2ray-poseidon</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修改配置文件"><span class="toc-number">4.3.</span> <span class="toc-text">修改配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#添加站点"><span class="toc-number">4.4.</span> <span class="toc-text">添加站点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动docker"><span class="toc-number">4.5.</span> <span class="toc-text">启动 Docker</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置相关"><span class="toc-number">5.</span> <span class="toc-text">配置相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#支付配置"><span class="toc-number">5.1.</span> <span class="toc-text">支付配置</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/computer-science/note/v2yume-setup-log/" rel="bookmark">V2Yume 配置记录</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Ruri Shimotsuki" data-src="//cdn.jsdelivr.net/gh/amehime/shoka@latest/images/avatar.jpg"><p class="name" itemprop="name">Ruri Shimotsuki</p><div class="description" itemprop="description">琉璃的医学 & 编程笔记</div></div><nav class="state"><div class="item posts"><span class="count">18</span> <span class="name">文章</span></div><div class="item categories"><span class="count">13</span> <span class="name">分类</span></div><div class="item tags"><span class="count">4</span> <span class="name">标签</span></div></nav><div class="social"><a href="https://github.com/amehime" title="https:&#x2F;&#x2F;github.com&#x2F;amehime" class="item github" rel="noopener" target="_blank"><i class="ic i-github"></i></a> <a href="https://twitter.com/amehime" title="https:&#x2F;&#x2F;twitter.com&#x2F;amehime" class="item twitter" rel="noopener" target="_blank"><i class="ic i-twitter"></i></a> <a href="https://www.zhihu.com/people/rurismzk" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;rurismzk" class="item zhihu" rel="noopener" target="_blank"><i class="ic i-zhihu"></i></a> <a href="https://music.163.com/#/user/home?id=12886823" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;12886823" class="item music" rel="noopener" target="_blank"><i class="ic i-cloud-music"></i></a> <a href="https://weibo.com/amehime" title="https:&#x2F;&#x2F;weibo.com&#x2F;amehime" class="item weibo" rel="noopener" target="_blank"><i class="ic i-weibo"></i></a> <a href="https://about.me/amehime" title="https:&#x2F;&#x2F;about.me&#x2F;amehime" class="item about" rel="noopener" target="_blank"><i class="ic i-address-card"></i></a></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-archive"></i>归档</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>网址</a></li></ul></div></div></div><ul class="quick"><li class="prev pjax"><a href="/computer-science/cpp/course-1/week-6/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/interdisciplinary/health-informatics/specialization-1/course-1/week-1/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer><div class="inner"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Ruri Shimotsuki @ Yume Shoka</span></div><div><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">114k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">1:43</span></div><div class="powered-by">基于 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & Theme.<a href="https://amehime.github.io/shoka" rel="noopener" target="_blank">Yume</a></div></div></footer></div><script type="text/javascript">var CONFIG={hostname:"shoka.lostyu.me",root:"/",assets:"//cdn.jsdelivr.net/gh/amehime/shoka@latest/",favicon:{normal:"images/favicon.ico",hidden:"images/failure.ico",show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},comments:{appId:"GfnpjP6kVt5Hwl5FDnWDCEX3-gzGzoHsz",appKey:"5VPzAxojlyJTTif1RMYNBBQy",placeholder:"ヽ(○´∀`)ﾉ♪",avatar:"mm",pageSize:10,visitor:!0,lang:"zh-cn",recordIP:!0,serverURLs:""},search:{appID:"8AVSL3TE18",apiKey:"439b6e54d1a5364824e689b5ca5a55db",indexName:"shoka",hits:{per_page:10},labels:{input_placeholder:"文章搜索",hits_empty:"关于 ${query} ，什么也没搜到",hits_stats:"${time} ms 内找到 ${hits} 条结果"}}}</script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/katex@0/dist/contrib/copy-tex.min.js,npm/velocity-animate@1.5.2/velocity.min.js,npm/velocity-animate@1.5.2/velocity.ui.min.js,npm/valine@1.4.14/dist/Valine.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js"></script><script src="//cdn.jsdelivr.net/gh/amehime/shoka@latest/js/app.js"></script></body></html>